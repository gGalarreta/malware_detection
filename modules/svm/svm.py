import numpy as np
import os
from sklearn import svm

class Svm():

  def __init__(self):
    self.classes_number = 8
    self.classes = []
    self.x_train = None
    self.y_train = None
    self.model = None
    self.features_directory = None
    self.train_samples = None
    self.test_samples = None
    self.classes_directory = None


  def set_features_directory(self, value):
    self.features_directory = value

  def set_train_samples(self, value):
    self.train_samples = value

  def set_test_samples(self, value):
    self.test_samples = value

  def set_classes_directory(self, value):
    self.classes_directory = value

  def build(self):
    self.set_settings(classes_directory)
    for folder in os.listdir(self.features_directory):
      train_directory = self.features_directory + "/" + folder + self.train_samples
      test_directory = self.features_directory + "/" + folder +self.test_samples
      self.x_train = self.load(train_directory)
      self.y_train = self.load(test_directory)
      model = svm.SVC(kernel='linear', C=1,gamma=0)
      model.fit(self.x_train, self.y_train) 

  def set_data(self, data_directory, classes_directory):
    file = open(data_directory, 'r')
    features_list = []
    classes_list = []
    features_number = 0
    samples_number = 0
    for line in file:
      sample_class, features = self.get_values(line.split(","))
      features_list =  features + features_list
      classes_list = [sample_class] + classes_list
      samples_number += 1
      features_number = len(features)
    self.set_input_size(1, features_number)
    return np.asarray(features_list).reshape(samples_number, features_number), np.asarray(classes_list).reshape(samples_number, 1)

  def get_values(self, data):
    #0 -> name
    #1 .. n-1 -> features
    #n -> class
    #number of features must be the same with the quantity of elements of the list resulting TODO
    return self.get_class(data), self.get_features(data)

  def set_settings(self, classes_directory):
    self.classes = self.read_file(classes_directory)
    self.classes_number = len(self.classes)

  def get_features(self, data):
    #remove class value and \n
    data.pop()
    data.pop()
    #remove sample_name
    data.pop(0)
    return data    

  def read_file(self, file_name):
    lines = [line.rstrip('\n') for line in open(file_name)]
    #little bug :(  TODO
    #temp fix
    lines = [word.lower() for word in lines]
    return lines

  def set_input_size(self, lower_size, upper_size):
    self.input_size = (lower_size, upper_size)    