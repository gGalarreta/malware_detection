import pandas as pd
from sklearn.cluster import AgglomerativeClustering
from scipy.cluster.hierarchy import dendrogram, linkage
import matplotlib.pylab as plt

class Agglomerative():

  def __init__(self):
    self.max_d = 7.08
    self.cut_off = 150

  def set_max_d(self, value):
    self.max_d = value

  def set_cut_off(self, value):
    self.cut_off = value

  def get_dendograms(self, data, output_file):
    # generate the linkage matrix
    Z = linkage(data, 'centroid')

    # set cut-off to 150
    max_d = self.max_d                # max_d as in max_distance

    plt.figure(figsize=(15, 10))
    plt.title('Hierarchical Clustering Dendrogram')
    plt.xlabel('Families')
    plt.ylabel('distance')
    dendrogram(
        Z,
        truncate_mode='lastp',  # show only the last p merged clusters
        p = self.cut_off,                  # Try changing values of p
        leaf_rotation = 90.,      # rotates the x axis labels
        leaf_font_size = 8.,      # font size for the x axis labels
    )
    plt.axhline(y = max_d, c = 'k')
    plt.savefig(output_file)
