import sys
import pefile
import pydasm

class Opcode():

  def __init__(self):
    self.max_number = sys.maxint

  def disassemble(self, pe_data, file_name):
    file = open(file_name, "w")
    ep = pe_data.OPTIONAL_HEADER.AddressOfEntryPoint
    ep_ava = ep+pe_data.OPTIONAL_HEADER.ImageBase
    data = pe_data.get_memory_mapped_image()[ep:ep+self.max_number]
    offset = 0
    while offset < len(data):
      i = pydasm.get_instruction(data[offset:], pydasm.MODE_32)
      instruction = pydasm.get_instruction_string(i, pydasm.FORMAT_INTEL, ep_ava+offset)
      if instruction == None :
        break
      offset += i.length
      file.write(instruction.split(' ', 1)[0])
      file.write('\n')
